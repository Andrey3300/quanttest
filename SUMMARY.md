# ‚úÖ –†–ï–ó–Æ–ú–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã **–≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–µ—à–µ–Ω–∏—è** –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–≤–µ—á–µ–π.

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `backend/server.js`
**–°—Ç—Ä–æ–∫–∞ 388:** –ò–∑–º–µ–Ω–µ–Ω –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–∏–∫–æ–≤  
**–ë–´–õ–û:** `150ms`  
**–°–¢–ê–õ–û:** `450ms` (–≤ 3 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ)

### 2. `frontend/chart.js`
**–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

#### Constructor (—Å—Ç—Ä–æ–∫–∏ 5-28):
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω `updateThrottle`: `50ms` ‚Üí `150ms`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `scrollDebounceTimer` –¥–ª—è debounce
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `isAdjustingScale` –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è autoScale
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `MIN_VISIBLE_BARS = 10` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `isRestoringRange` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ä–µ–∫—É—Ä—Å–∏–∏

#### init() (—Å—Ç—Ä–æ–∫–∏ 156-194):
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ `subscribeVisibleLogicalRangeChange`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞

#### updateCandle() (—Å—Ç—Ä–æ–∫–∏ 444-558):
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω debounce (50ms) –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞
- ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù** —Ä–∞—Å—á–µ—Ç –≤–∏–¥–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —à–∏—Ä–∏–Ω—ã –¥–∏–∞–ø–∞–∑–æ–Ω–∞
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ autoScale –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤

---

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### ‚úÖ –†–ï–®–ï–ù–ò–ï #1: –ö–æ–Ω—Ç—Ä–æ–ª—å autoScale
**–ü—Ä–æ–±–ª–µ–º–∞:** Race condition –º–µ–∂–¥—É –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º —Å–∫—Ä–æ–ª–ª–æ–º –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º  
**–†–µ—à–µ–Ω–∏–µ:** –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º autoScale –ø–µ—Ä–µ–¥ `setVisibleLogicalRange()`, –∑–∞—Ç–µ–º –≤–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ 150ms

### ‚úÖ –†–ï–®–ï–ù–ò–ï #3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç —à–∏—Ä–∏–Ω—ã –≤–∏–¥–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –ø—Ä–∏–≤–æ–¥–∏–ª –∫ —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—é  
**–†–µ—à–µ–Ω–∏–µ:** 
```javascript
// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç:
const totalWidth = currentRange.to - currentRange.from;
const pureVisibleBars = Math.floor(totalWidth - rightOffsetBars);
const newFrom = Math.max(0, lastRealCandleIndex - pureVisibleBars);
const newTo = lastRealCandleIndex + rightOffsetBars;
```

### ‚úÖ –†–ï–®–ï–ù–ò–ï #6: Debounce –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã `setVisibleLogicalRange()` —Å–æ–∑–¥–∞—é—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã  
**–†–µ—à–µ–Ω–∏–µ:** 50ms debounce –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –Ω–æ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞

### ‚úÖ –†–ï–®–ï–ù–ò–ï #7: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–∂–µ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã —Ä–µ–¥–∫–∏–µ —Å–ª—É—á–∞–∏ —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—è  
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —à–∏—Ä–∏–Ω—ã –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### ‚úÖ –ë–û–ù–£–°: –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–≤–µ—á–∏ –¥–≤–∏–≥–∞–ª–∏—Å—å —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ (–∫–∞–∂–¥—ã–µ 150ms)  
**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–µ–Ω –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ 450ms - –≤ 3 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ

---

## üìä –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|------|-------|---------|
| –ò–Ω—Ç–µ—Ä–≤–∞–ª —Ç–∏–∫–æ–≤ (backend) | 150ms | **450ms** | –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –≤ 3 —Ä–∞–∑–∞ |
| –¢—Ä–æ—Ç—Ç–ª–∏–Ω–≥ (frontend) | 50ms | **150ms** | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å backend |
| Debounce —Å–∫—Ä–æ–ª–ª–∞ | - | **50ms** | –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–µ–π |
| –ó–∞–¥–µ—Ä–∂–∫–∞ autoScale | - | **150ms** | –ò–∑–±–µ–∂–∞–Ω–∏–µ race condition |
| –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ | - | **10 —Å–≤–µ—á–µ–π** | –ó–∞—â–∏—Ç–∞ –æ—Ç —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—è |

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
```bash
cd backend
npm start
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
–ü–µ—Ä–µ–π–¥–∏—Ç–µ: `http://localhost:3001`

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)
–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
[Logger] Error logging system initialized
üìä Chart Debug Logger Commands:
exportLogs()      - Export logs as JSON file
exportLogsText()  - Export logs as readable text file
logStats()        - Show logging statistics
clearLogs()       - Clear all logs
```

### 4. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –≥—Ä–∞—Ñ–∏–∫–æ–º
- ‚úÖ –°–≤–µ—á–∏ –¥–≤–∏–∂—É—Ç—Å—è **–ø–ª–∞–≤–Ω–æ** (–Ω–µ —Ä—ã–≤–∫–∞–º–∏)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **~2 —Ä–∞–∑–∞ –≤ —Å–µ–∫—É–Ω–¥—É** (—Ä–∞–Ω—å—à–µ –±—ã–ª–æ ~7 —Ä–∞–∑)
- ‚úÖ –ì—Ä–∞—Ñ–∏–∫ **–ù–ï —Å—Ö–ª–æ–ø—ã–≤–∞–µ—Ç—Å—è** –≤ –ª–∏–Ω–∏—é
- ‚úÖ –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π**

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
```javascript
logStats()
```
–í `error` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **0** –∏–ª–∏ –º–∏–Ω–∏–º—É–º –æ—à–∏–±–æ–∫

---

## üö® –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–±–ª–µ–º

### ‚ùå –ü–ª–æ—Ö–æ (–Ω—É–∂–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å):
```
[ERROR][range] Invalid range calculated!
[ERROR][range] Preventing chart collapse - range too narrow!
```

### ‚ö†Ô∏è –ù–æ—Ä–º–∞–ª—å–Ω–æ (–∑–∞—â–∏—Ç–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞):
```
[ERROR][range] Chart collapse detected! Restoring safe range...
```
*–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ*

### ‚úÖ –û—Ç–ª–∏—á–Ω–æ (–≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç):
```
[DEBUG][range] Before scroll calculation
[DEBUG][range] Scroll calculation result  
[DEBUG][range] Range applied successfully
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **CHANGELOG_FIXES.md** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—à–µ–Ω–∏–π
2. **TEST_FIXES.md** - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
3. **QUICK_DEBUG_INSTRUCTIONS.md** - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ—Ç–ª–∞–¥–∫–µ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç **–∏–¥–µ–∞–ª—å–Ω–æ** –µ—Å–ª–∏:

- ‚úÖ –°–≤–µ—á–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø–ª–∞–≤–Ω–æ (~2 —Ä–∞–∑–∞/—Å–µ–∫ –≤–º–µ—Å—Ç–æ ~7)
- ‚úÖ –ù–æ–≤–∞—è —Å–≤–µ—á–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ì—Ä–∞—Ñ–∏–∫ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å—Ö–ª–æ–ø—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í –ª–æ–≥–∞—Ö –Ω–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- ‚úÖ –ü—Ä–∏ —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üîç –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```javascript
// –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–æ–≥–æ–≤
logStats()

// –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
exportLogsText()

// –§–∏–ª—å—Ç—Ä—ã
window.errorLogger.filter({ category: 'range' })
window.errorLogger.filter({ level: 'error' })

// –û—á–∏—Å—Ç–∫–∞
clearLogs()
```

---

## üí° –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

**Backend** (`server.js:388`):
```javascript
}, 450); // ‚Üê –ò–∑–º–µ–Ω–∏—Ç–µ (300-600ms)
```

**Frontend** (`chart.js:14`):
```javascript
this.updateThrottle = 150; // ‚Üê –ò–∑–º–µ–Ω–∏—Ç–µ (—Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 1:3 —Å backend)
```

### –ò–∑–º–µ–Ω–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É:

**Frontend** (`chart.js:26`):
```javascript
this.MIN_VISIBLE_BARS = 10; // ‚Üê –£–≤–µ–ª–∏—á—å—Ç–µ –¥–æ 20-30 –¥–ª—è –±–æ–ª—å—à–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

### –ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É autoScale:

**Frontend** (`chart.js:544`):
```javascript
}, 150); // ‚Üê –ò–∑–º–µ–Ω–∏—Ç–µ (100-300ms)
```

---

## ‚ú® –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ! üéâ

–ì—Ä–∞—Ñ–∏–∫ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç:
- üõ°Ô∏è **4 —É—Ä–æ–≤–Ω—è –∑–∞—â–∏—Ç—ã** –æ—Ç —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—è
- üêå **–ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ** —Å–≤–µ—á–µ–π (–≤ 3 —Ä–∞–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
- üìä **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

**–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!** üöÄ
