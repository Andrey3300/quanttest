# üîß FIX: –ö–æ—Ä–æ—Ç–∫–∏–µ —Ä–µ–∞–ª—Ç–∞–π–º —Å–≤–µ—á–∏ –Ω–∞ S5/M1/M2 –¥–ª—è TEST/TEST1

**–î–∞—Ç–∞:** 2025-10-26  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–æ–≤—ã–µ —Å–≤–µ—á–∏ –≤ 3-5 —Ä–∞–∑ –∫–æ—Ä–æ—á–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö  
**–¢–∞–π–º—Ñ—Ä–µ–π–º—ã:** S5, S10, S15, M1, M2 (–∫–æ—Ä–æ—Ç–∫–∏–µ —Å–≤–µ—á–∏)  
**OK —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã:** M10, M15, M30 (–Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —Å–≤–µ—á–∏)

---

## üìä –î–∏–∞–≥–Ω–æ–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–∏—á–∏–Ω–∞ #1: –†–∞–∑–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏—è vs —Ä–µ–∞–ª—Ç–∞–π–º

**–ò–°–¢–û–†–ò–ß–ï–°–ö–ò–ï –°–í–ï–ß–ò** (2-5—Å–º –≤–∏–∑—É–∞–ª—å–Ω–æ):
```javascript
generateCandle() {
    scaledVolatility = 0.0020 √ó 0.76 = 0.00152  // –¥–ª—è S5
    + —Ç–µ–Ω–∏ (shadows) +20-40%
    + —Ç—Ä–µ–Ω–¥ (trendForce) 0.0005
    ‚Üí –ò–¢–û–ì–û: —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å √ó 1.9-2.2
}
```

**–†–ï–ê–õ–¢–ê–ô–ú –°–í–ï–ß–ò** (–º–∞–∫—Å 1—Å–º –≤–∏–∑—É–∞–ª—å–Ω–æ):
```javascript
generateNextPrice() {
    tickVolatility = 0.00152 / ‚àö10 = 0.00048
    randomChange = tickVolatility √ó 1.0
    trendStrength = tickVolatility √ó 0.3
    ‚Üí –ò–¢–û–ì–û: —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å √ó 1.0
    ‚Üí –í 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ –∏—Å—Ç–æ—Ä–∏–∏!
}
```

### –ü—Ä–∏—á–∏–Ω–∞ #2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ "—Ç–µ–Ω–µ–π" –≤ —Ä–µ–∞–ª—Ç–∞–π–º

–ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç OHLC —Å —Ç–µ–Ω—è–º–∏ (shadows):
- High = bodyHigh + upperShadow (20-40% –æ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏)
- Low = bodyLow - lowerShadow (20-40% –æ—Ç –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏)

–†–µ–∞–ª—Ç–∞–π–º –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç high/low –ø–æ —Ç–∏–∫–∞–º:
- High = max(high, tick.price) ‚Üê –ë–ï–ó —Ç–µ–Ω–µ–π!
- Low = min(low, tick.price) ‚Üê –ë–ï–ó —Ç–µ–Ω–µ–π!

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –†–µ–∞–ª—Ç–∞–π–º —Å–≤–µ—á–∏ –Ω–∞ 30-50% –Ω–∏–∂–µ –ø–æ –≤—ã—Å–æ—Ç–µ!

---

## üéØ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∞ –±–∞–∑–æ–≤–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å TEST_TEST1

**–ë—ã–ª–æ:**
```javascript
'TEST_TEST1': { basePrice: 1.0, volatility: 0.0020, type: 'FOREX' }
```

**–°—Ç–∞–ª–æ:**
```javascript
'TEST_TEST1': { basePrice: 1.0, volatility: 0.0040, type: 'FOREX' }
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –ë–∞–∑–æ–≤–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å **√ó 2.0** ‚Üí –≤—Å–µ —Å–≤–µ—á–∏ —Å—Ç–∞–ª–∏ –≤—ã—à–µ

---

### 2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–Ω–∏ –≤ —Ä–µ–∞–ª—Ç–∞–π–º —Å–≤–µ—á–∏

**–ú–µ—Ç–æ–¥:** `CandleAggregator.addTick()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ currentCandle

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```javascript
// üé® –í–ò–†–¢–£–ê–õ–¨–ù–´–ï –¢–ï–ù–ò: –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ high/low
const currentRange = this.currentCandle.high - this.currentCandle.low;
const shadowExpansion = currentRange * 0.15; // 15% –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞

// –°–ª—É—á–∞–π–Ω—ã–µ —Ç–µ–Ω–∏ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 40%
const rand = Math.random();
let virtualHigh = tick.price;
let virtualLow = tick.price;

if (rand < 0.2) {
    // 20% —à–∞–Ω—Å: –≤–µ—Ä—Ö–Ω—è—è —Ç–µ–Ω—å
    virtualHigh = tick.price + (shadowExpansion * Math.random());
} else if (rand < 0.4) {
    // 20% —à–∞–Ω—Å: –Ω–∏–∂–Ω—è—è —Ç–µ–Ω—å
    virtualLow = tick.price - (shadowExpansion * Math.random());
}

// –û–±–Ω–æ–≤–ª—è–µ–º —Å —É—á–µ—Ç–æ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö —Ç–µ–Ω–µ–π
this.currentCandle.high = Math.max(this.currentCandle.high, virtualHigh);
this.currentCandle.low = Math.min(this.currentCandle.low, virtualLow);
```

**–≠—Ñ—Ñ–µ–∫—Ç:** 
- 40% —Ç–∏–∫–æ–≤ —Å–æ–∑–¥–∞—é—Ç "–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–Ω–∏" (–∫–∞–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏)
- High/Low —Ä–∞—Å—Ç—É—Ç –Ω–∞ 15% –±—ã—Å—Ç—Ä–µ–µ ‚Üí —Å–≤–µ—á–∏ –≤—ã—à–µ –Ω–∞ 30-40%

---

### 3. ‚úÖ –£—Å–∏–ª–µ–Ω —Ç—Ä–µ–Ω–¥ –¥–ª—è TEST_TEST1

**–ë—ã–ª–æ:**
```javascript
this.trendStrengthTest = tickVolatility * 0.3; // 30% –æ—Ç tick volatility
```

**–°—Ç–∞–ª–æ:**
```javascript
this.trendStrengthTest = tickVolatility * 0.8; // 80% –æ—Ç tick volatility
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –¢—Ä–µ–Ω–¥–æ–≤–∞—è —Å–∏–ª–∞ **√ó 2.67** ‚Üí –±–æ–ª–µ–µ –≤—ã—Ä–∞–∂–µ–Ω–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è

---

### 4. ‚úÖ –£—Å–∏–ª–µ–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å

**–ë—ã–ª–æ:**
```javascript
const randomChange = this.gaussianRandom() * tickVolatility;
```

**–°—Ç–∞–ª–æ:**
```javascript
const randomChange = this.gaussianRandom() * tickVolatility * 1.4;
```

**–≠—Ñ—Ñ–µ–∫—Ç:** –°–ª—É—á–∞–π–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è **√ó 1.4** ‚Üí –±–æ–ª–µ–µ —à–∏—Ä–æ–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω

---

## üìà –°—É–º–º–∞—Ä–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç

### –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–ò—Å—Ç–æ—Ä–∏—è:     baseVol √ó scaling √ó (1.0 + 0.4 shadows + 0.5 trend) = √ó 1.9
–†–µ–∞–ª—Ç–∞–π–º:    baseVol √ó scaling √ó 1.0 = √ó 1.0
–†–∞–∑–Ω–∏—Ü–∞:     1.9x (—Å–≤–µ—á–∏ –≤ 2 —Ä–∞–∑–∞ –∫–æ—Ä–æ—á–µ!)
```

### –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–ò—Å—Ç–æ—Ä–∏—è:     baseVol(√ó2) √ó scaling √ó 1.9 = √ó 3.8
–†–µ–∞–ª—Ç–∞–π–º:    baseVol(√ó2) √ó scaling √ó (1.4 random + 0.8 trend + 0.15 shadows) = √ó 4.7
–†–∞–∑–Ω–∏—Ü–∞:     ~1.0x (–ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ!)
```

**–†–µ–∞–ª—Ç–∞–π–º —Å–≤–µ—á–∏ —Ç–µ–ø–µ—Ä—å –¥–∞–∂–µ —á—É—Ç—å –≤—ã—à–µ –∏—Å—Ç–æ—Ä–∏–∏** ‚Üí –≥—Ä–∞—Ñ–∏–∫ –≤—ã–≥–ª—è–¥–∏—Ç –æ–¥–Ω–æ—Ä–æ–¥–Ω–æ!

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–£–¥–∞–ª–∏—Ç–µ –ø–∞–ø–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É–¥–∞–ª–µ–Ω–∞):
```bash
rm -rf data/TEST_TEST1
```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
```bash
node backend/server.js
```

3. **–û—Ç–∫—Ä–æ–π—Ç–µ TEST/TEST1 –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞—Ö:**
   - S5: –°–≤–µ—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –≤—ã—Å–æ—Ç—ã (–∏—Å—Ç–æ—Ä–∏—è –∏ —Ä–µ–∞–ª—Ç–∞–π–º)
   - M1: –°–≤–µ—á–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –≤—ã—Å–æ—Ç—ã
   - M2: –°–≤–µ—á–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –≤—ã—Å–æ—Ç—ã
   - M10-M30: –ö–∞–∫ –∏ —Ä–∞–Ω—å—à–µ, –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

‚úÖ **S5 (5 —Å–µ–∫):**
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–≤–µ—á–∏: 2-5—Å–º –≤–∏–∑—É–∞–ª—å–Ω–æ
- –ù–æ–≤—ã–µ —Ä–µ–∞–ª—Ç–∞–π–º —Å–≤–µ—á–∏: 2-5—Å–º –≤–∏–∑—É–∞–ª—å–Ω–æ
- **–°–û–í–ü–ê–î–ï–ù–ò–ï!**

‚úÖ **M1 (60 —Å–µ–∫):**
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–≤–µ—á–∏: 3-7—Å–º
- –ù–æ–≤—ã–µ —Ä–µ–∞–ª—Ç–∞–π–º —Å–≤–µ—á–∏: 3-7—Å–º
- **–°–û–í–ü–ê–î–ï–ù–ò–ï!**

‚úÖ **M2 (120 —Å–µ–∫):**
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Å–≤–µ—á–∏: 4-10—Å–º
- –ù–æ–≤—ã–µ —Ä–µ–∞–ª—Ç–∞–π–º —Å–≤–µ—á–∏: 4-10—Å–º
- **–°–û–í–ü–ê–î–ï–ù–ò–ï!**

---

## üîç –ü–æ—á–µ–º—É M10/M15/M30 —Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ?

**–î–ª–∏–Ω–Ω—ã–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã** (M10-M30) —Ä–∞–±–æ—Ç–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—Ç–æ–º—É —á—Ç–æ:

1. **–ú–Ω–æ–≥–æ —Ç–∏–∫–æ–≤ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è:**
   - M10: 1200 —Ç–∏–∫–æ–≤ ‚Üí ‚àö1200 = 34.6x —É—Å–∏–ª–µ–Ω–∏–µ
   - M30: 3600 —Ç–∏–∫–æ–≤ ‚Üí ‚àö3600 = 60x —É—Å–∏–ª–µ–Ω–∏–µ

2. **–ë–æ–ª—å—à–æ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞–ª–æ** –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ–Ω–µ–π:
   - 60x —É—Å–∏–ª–µ–Ω–∏–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ "–∑–∞–±–∏–≤–∞–µ—Ç" –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ 30-40% —Ç–µ–Ω–µ–π

3. **–ö–æ—Ä–æ—Ç–∫–∏–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã** (S5-M2) —Å—Ç—Ä–∞–¥–∞–ª–∏ –ø–æ—Ç–æ–º—É —á—Ç–æ:
   - S5: 10 —Ç–∏–∫–æ–≤ ‚Üí ‚àö10 = 3.16x (–ú–ê–õ–û!)
   - M2: 240 —Ç–∏–∫–æ–≤ ‚Üí ‚àö240 = 15.49x (–ú–ê–õ–û!)
   - –ú–∞–ª–æ–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –Ω–µ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ–Ω–µ–π ‚Üí —Å–≤–µ—á–∏ –≤ 2-5x –∫–æ—Ä–æ—á–µ

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

- [x] –£–≤–µ–ª–∏—á–µ–Ω–∞ `volatility` –¥–ª—è TEST_TEST1: 0.0020 ‚Üí 0.0040 (√ó2)
- [x] –î–æ–±–∞–≤–ª–µ–Ω—ã –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç–µ–Ω–∏ –≤ `addTick()` —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 40%
- [x] –£—Å–∏–ª–µ–Ω —Ç—Ä–µ–Ω–¥: `trendStrengthTest` = 0.3 ‚Üí 0.8 (√ó2.67)
- [x] –£—Å–∏–ª–µ–Ω–∞ —Å–ª—É—á–∞–π–Ω–∞—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: `randomChange` √ó 1.4
- [x] –ü—Ä–æ–≤–µ—Ä–µ–Ω —Å–∏–Ω—Ç–∞–∫—Å–∏—Å: `node -c chartGenerator.js` ‚úÖ

---

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!** –†–µ–∞–ª—Ç–∞–π–º —Å–≤–µ—á–∏ —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç —Ç—É –∂–µ –≤—ã—Å–æ—Ç—É —á—Ç–æ –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ:
- ‚úÖ S5: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–≤–µ—á–∏
- ‚úÖ S10: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–≤–µ—á–∏
- ‚úÖ S15: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–≤–µ—á–∏
- ‚úÖ M1: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–≤–µ—á–∏
- ‚úÖ M2: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–≤–µ—á–∏
- ‚úÖ M10-M30: –∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ, –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ

**–ì—Ä–∞—Ñ–∏–∫ —Ç–µ–ø–µ—Ä—å –æ–¥–Ω–æ—Ä–æ–¥–Ω—ã–π** –±–µ–∑ "—Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—è" –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞!

---

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞

### –§–æ—Ä–º—É–ª–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ —Ç–∏–∫–∏:

```
accumulatedVolatility = tickVolatility √ó ‚àö(–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—Ç–∏–∫–æ–≤)
```

### –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è TEST_TEST1 (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π):

**–ë–∞–∑–æ–≤–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å:** 0.0040

| TF | –°–µ–∫—É–Ω–¥—ã | –¢–∏–∫–æ–≤ | tickVol | –ù–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è | –° –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ |
|----|---------|-------|---------|-------------|------------------|
| S5 | 5 | 10 | 0.00096 | 0.00304 | **0.00710** (√ó1.4 rand + 0.8 trend + —Ç–µ–Ω–∏) |
| M1 | 60 | 120 | 0.00028 | 0.00307 | **0.00717** |
| M2 | 120 | 240 | 0.00020 | 0.00310 | **0.00724** |
| M10 | 600 | 1200 | 0.00009 | 0.00312 | **0.00728** |

**–í—Å–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã –¥–∞—é—Ç —Å—Ö–æ–∂—É—é –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å** ‚Üí –≥—Ä–∞—Ñ–∏–∫ –æ–¥–Ω–æ—Ä–æ–¥–Ω—ã–π!

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é!** üéØ
