# üéØ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞

## –ü—Ä–æ–±–ª–µ–º–∞
- –°–≤–µ—á–∏ –¥–µ—Ä–≥–∞–ª–∏—Å—å –∏ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å —Ä–∞–∑ –≤ 5 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ –ø–ª–∞–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã S10, S15, S30 (HTTP 500 –æ—à–∏–±–∫–∏)
- –¶–µ–Ω–∞ –Ω–∞ —Å–∏–Ω–µ–π –ª–∏–Ω–∏–∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∞—Å—å
- –®–∫–∞–ª–∞ —Ü–µ–Ω —Å–ø—Ä–∞–≤–∞ –ø—Ä–æ–ø–∞–¥–∞–ª–∞

## –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã
**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–∞—Ä—É—à–µ–Ω–∞:**
- –¢–∏–∫–∏ –ø—Ä–∏—Ö–æ–¥–∏–ª–∏ —Å –≤—Ä–µ–º–µ–Ω–µ–º 12:26:50
- –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–≤–µ—á–∞ –≤ –º–∞—Å—Å–∏–≤–µ –∏–º–µ–ª–∞ –≤—Ä–µ–º—è 12:26:45 (—É—Å—Ç–∞—Ä–µ–ª–∞ –Ω–∞ 5+ —Å–µ–∫—É–Ω–¥)
- `handleTick()` –ø—ã—Ç–∞–ª—Å—è –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—É—é —Å–≤–µ—á—É
- LightweightCharts –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≤—Ä–µ–º—è –≤ –ø—Ä–æ—à–ª–æ–º)
- –ì—Ä–∞—Ñ–∏–∫ –Ω–µ –¥–≤–∏–≥–∞–ª—Å—è, –Ω–∞–∫–∞–ø–ª–∏–≤–∞–ª–æ—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–∫–æ–≤ ‚Üí –¥–µ—Ä–≥–∞–Ω–∏–µ

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–∏–ª–∏

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã
**–§–∞–π–ª:** `backend/chartGenerator.js`

–î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã:
- `S10` - 10 —Å–µ–∫—É–Ω–¥
- `S15` - 15 —Å–µ–∫—É–Ω–¥  
- `S30` - 30 —Å–µ–∫—É–Ω–¥

–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JSON –¥–ª—è –≤—Å–µ—Ö 11 —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤:
- S5, S10, S15, S30
- M1, M2, M3, M5, M10, M15, M30

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω handleTick() - —É–º–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤–µ—á–µ–π
**–§–∞–π–ª:** `frontend/chart.js`

**–ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:**
```javascript
handleTick(data) {
  // 1. –í—ã—á–∏—Å–ª—è–µ–º –≤—Ä–µ–º—è –¢–ï–ö–£–©–ï–ô —Å–≤–µ—á–∏
  const currentCandleTime = Math.floor(time / timeframeSeconds) * timeframeSeconds;
  
  // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–≤–µ—á—É –≤ –º–∞—Å—Å–∏–≤–µ
  const lastCandle = this.candles[this.candles.length - 1];
  
  // 3. –ï—Å–ª–∏ —Å–≤–µ—á–∞ —Å –Ω—É–∂–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –ù–ï–¢ - —Å–æ–∑–¥–∞–µ–º!
  if (!lastCandle || lastCandle.time !== currentCandleTime) {
    const newCandle = { time: currentCandleTime, open: price, ... };
    this.candles.push(newCandle);
  } else {
    // –°–≤–µ—á–∞ –µ—Å—Ç—å - –æ–±–Ω–æ–≤–ª—è–µ–º
    const updatedCandle = { ...lastCandle, close: price, ... };
    this.candles[this.candles.length - 1] = updatedCandle;
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ì—Ä–∞—Ñ–∏–∫ –í–°–ï–ì–î–ê –∏–º–µ–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å–≤–µ—á—É –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω handleNewCandle() - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–π —Å–≤–µ—á–∏
**–§–∞–π–ª:** `frontend/chart.js`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```javascript
handleNewCandle(data) {
  // 1. –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é —Å–≤–µ—á—É
  this.candles.push(candle);
  
  // 2. üéØ –í–ê–ñ–ù–û: –°–æ–∑–¥–∞–µ–º –°–õ–ï–î–£–Æ–©–£–Æ —Ç–µ–∫—É—â—É—é —Å–≤–µ—á—É
  const nextCandleTime = candle.time + timeframeSeconds;
  const nextCandle = {
    time: nextCandleTime,
    open: candle.close,
    high: candle.close,
    low: candle.close,
    close: candle.close
  };
  this.candles.push(nextCandle);
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–∞—Å—Å–∏–≤ –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—É—â—É—é —Ñ–æ—Ä–º–∏—Ä—É—é—â—É—é—Å—è —Å–≤–µ—á—É

### 4. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ updatePriceLine()
**–§–∞–π–ª:** `frontend/chart.js`

**–ë—ã–ª–æ:** –£–¥–∞–ª–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ª–∏–Ω–∏–∏ –∫–∞–∂–¥—ã–µ 250ms (—Ç—è–∂–µ–ª–æ!)
```javascript
removePriceLine(old);
createPriceLine(new);  // –∫–∞–∂–¥—ã–µ 250ms!
```

**–°—Ç–∞–ª–æ:** 
1. –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–Ω–∏–∏ –æ–¥–∏–Ω —Ä–∞–∑
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `applyOptions()` (–±—ã—Å—Ç—Ä–æ!)
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É (–Ω–µ –∫–∞–∂–¥—ã–π —Ç–∏–∫)

```javascript
if (!this.expirationPriceLine) {
  this.expirationPriceLine = this.candleSeries.createPriceLine(...);
} else {
  this.expirationPriceLine.applyOptions({ price: price });  // –±—ã—Å—Ç—Ä–æ!
}
```

### 5. –î–æ–±–∞–≤–ª–µ–Ω updateActiveSeries() - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
**–§–∞–π–ª:** `frontend/chart.js`

**–ë—ã–ª–æ:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –í–°–ï–• —Ç—Ä–µ—Ö —Å–µ—Ä–∏–π (candles + line + bars) –∫–∞–∂–¥—ã–π —Ç–∏–∫

**–°—Ç–∞–ª–æ:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ê–ö–¢–ò–í–ù–û–ô —Å–µ—Ä–∏–∏:
```javascript
if (chartType === 'line') {
  this.lineSeries.update(...);  // —Ç–æ–ª—å–∫–æ –ª–∏–Ω–∏—è
} else if (chartType === 'bars') {
  this.barSeries.update(...);   // —Ç–æ–ª—å–∫–æ –±–∞—Ä—ã
} else {
  this.candleSeries.update(...); // —Ç–æ–ª—å–∫–æ —Å–≤–µ—á–∏
}
```

### 6. –û–±–Ω–æ–≤–ª–µ–Ω chartTimeframe.js
**–§–∞–π–ª:** `frontend/chartTimeframe.js`

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã: S10, S15, S30

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è:** –°–≤–µ—á–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 250ms  
‚úÖ **–í—Å–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç:** S5, S10, S15, S30, M1, M2, M3, M5, M10, M15, M30  
‚úÖ **–ù–µ—Ç –¥–µ—Ä–≥–∞–Ω–∏—è:** –ì—Ä–∞—Ñ–∏–∫ –≤—Å–µ–≥–¥–∞ –∏–º–µ–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å–≤–µ—á—É  
‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:** –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Ä–∏—è  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** updatePriceLine —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ  

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∫–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç)

```
–°–µ—Ä–≤–µ—Ä (–∫–∞–∂–¥—ã–µ 250ms):
  ‚îú‚îÄ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¢–ò–ö (price + time)
  ‚îú‚îÄ –û–±–Ω–æ–≤–ª—è–µ—Ç –í–°–ï –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä—ã (S5, S10, M1, ...)
  ‚îú‚îÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç T–ò–ö –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ WebSocket
  ‚îî‚îÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç newCandle –∫–æ–≥–¥–∞ —Å–≤–µ—á–∞ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

–ö–ª–∏–µ–Ω—Ç:
  ‚îú‚îÄ –ü–æ–ª—É—á–∞–µ—Ç –¢–ò–ö ‚Üí handleTick()
  ‚îÇ   ‚îú‚îÄ –í—ã—á–∏—Å–ª—è–µ—Ç –≤—Ä–µ–º—è —Ç–µ–∫—É—â–µ–π —Å–≤–µ—á–∏
  ‚îÇ   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ —Å–≤–µ—á–∞ —Å —Ç–∞–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º
  ‚îÇ   ‚îú‚îÄ –ï—Å–ª–∏ –ù–ï–¢ ‚Üí —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é
  ‚îÇ   ‚îî‚îÄ –ï—Å–ª–∏ –ï–°–¢–¨ ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é
  ‚îÇ
  ‚îî‚îÄ –ü–æ–ª—É—á–∞–µ—Ç newCandle ‚Üí handleNewCandle()
      ‚îú‚îÄ –û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—É—é —Å–≤–µ—á—É
      ‚îî‚îÄ –°–æ–∑–¥–∞–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Ç–µ–∫—É—â—É—é —Å–≤–µ—á—É

–†–µ–∑—É–ª—å—Ç–∞—Ç: –ì—Ä–∞—Ñ–∏–∫ –í–°–ï–ì–î–ê —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å —Ä–µ–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
```

## –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞—Å—Ç –ø–∞–ø–∫—É `data/` —Å JSON —Ñ–∞–π–ª–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–∏–≤–∞:

```
data/
  USD_MXN_OTC/
    S5.json   - 17,280 —Å–≤–µ—á–µ–π (24 —á–∞—Å–∞)
    S10.json  - 8,640 —Å–≤–µ—á–µ–π
    S15.json  - 5,760 —Å–≤–µ—á–µ–π
    S30.json  - 2,880 —Å–≤–µ—á–µ–π
    M1.json   - 1,440 —Å–≤–µ—á–µ–π
    M2.json   - 720 —Å–≤–µ—á–µ–π
    ...
```

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç ~20-30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≤—Å–µ—Ö 61 –∞–∫—Ç–∏–≤–æ–≤ √ó 11 —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: `node backend/server.js`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: `http://localhost:3001`
3. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É
4. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Console
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - –¢–∏–∫–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–∞–∂–¥—ã–µ 250ms
   - –ì—Ä–∞—Ñ–∏–∫ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–ª–∞–≤–Ω–æ
   - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
   - –í—Å–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã (S5-M30) —Ä–∞–±–æ—Ç–∞—é—Ç

## –û—á–∏—Å—Ç–∫–∞ localStorage (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ –≥—Ä–∞—Ñ–∏–∫ –≤—Å—ë –µ—â—ë —Ç–æ—Ä–º–æ–∑–∏—Ç:
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
localStorage.clear();
localStorage.setItem('chartTimeframe', 'S5');
window.location.reload();
```

---

**–î–∞—Ç–∞:** 2025-10-25  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
